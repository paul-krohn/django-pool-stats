{% extends "stats/base.html" %}
{% block title %}SFPA :: Team :: Register {% endblock %}

{% block content %}

<h2>Register a team</h2>
<form id="team_save" action="{% url 'register'  %}" method="post">
    {% if form.non_form_errors %}
        {{ form.non_form_errors }}
    {% endif %}
    <table class="table" style="width: auto;">
    {% csrf_token %}
     <tr>
         <th>{{ form.name.label }}</th><td>{{ form.name }}</td><td>Try to include the sponsor venue's name. Feel free to be punny!</td>
     </tr>
     <tr>
         <th>{{ form.captain.label }}</th><td>{{ form.captain }}</td><td>Required field.</td>
     </tr>
     <tr>
         <th>{{ form.players.label }}</th>
         <td>{{ form.players }}</td>
         <td>
             <ol id="player_names">
                 {% if form.instance.id %}
                     {% for player_name in form.instance.players.all %}
                         <li>{{ player_name }}</li>
                     {% endfor %}
                 {% endif %}
             </ol>
         </td>
     </tr>
     <tr>
         <th>{{ form.table.label }}</th>
         <td>{{ form.table }}</td>
         <td>Don't worry if you aren't 100% sure of the venue and/or table, just leave it blank.</td>
     </tr>
    <tr>
        <td></td>
        <td>
            <input class="btn btn-primary" type="submit" value="Save team" />
        </td>
        <td>Done? Don't forget to save ...</td>
    </tr>
    </table>
</form>

<script type="text/javascript">

    $(document).ready(function() {
        $('#id_captain').prop('required', true);
        $('#id_players').multiselect({
            enableCaseInsensitiveFiltering: true,
            numberDisplayed: 1,
            onChange: function(){
                let player_names = [];
                let player_select = $('#id_players');  // this id chosen by Django internals
                player_select.find('option:selected').each(function(){
                    player_names.push($(this).text());
                });
                console.log('player names: ' + player_names);
                let namesOL = $('#player_names');
                namesOL.empty();
                namesOL.append(
                  player_names.map(player => $("<li>").text(player)
                ));
            },
        });
    });

</script>
{% endblock %}

