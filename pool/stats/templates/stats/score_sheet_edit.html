{% extends "stats/base.html" %}

{% block title %}SFPA :: Score Sheet :: {{ score_sheet.match }} {% endblock %}

{% block content %}
<script>

let lineup_ids = ['away_lineup', 'away_substitutions', 'home_lineup', 'home_substitutions'];

function toggler(some_div_id) {

    lineup_ids.forEach(function(anId){
        let toggle_div = $("#" + anId);
        if (anId === some_div_id) {
            toggle_div.css("display", toggle_div.css("display") === "block" ? "none" : "block");
        } else {
            toggle_div.css("display", "none");
        }
    });

}

$(document).ready(function(){

    lineup_ids.forEach(function(toggleDiv){
        $('#toggle-' + toggleDiv).click(function(){
            toggler(toggleDiv)
        });
    });

    $( "#last-game-reset-button" ).confirm({
        text: 'remove winner of last game?',
        confirm: reset_last_game
    });

});

</script>

<h5>{{ score_sheet.match.week }}, {{ score_sheet.match.week.date }}</h5>
<div>
    <form id="showhide">
        <input id="toggle-home_lineup" type="button" class="btn btn-default" value="Home Lineup" />
        <input id="toggle-home_substitutions" type="button" class="btn btn-default" value="Home Subs" /> â€¢
        <input id="toggle-away_lineup" type="button" class="btn btn-default" value="Away Lineup" />
        <input id="toggle-away_substitutions" type="button" class="btn btn-default" value="Away Subs" />
    </form>
</div>
{% with "away" as away_home %}
<div id="away_lineup" class="collapse showhide">
    {% with away_lineup_formset as lineup_formset %}
    {% include "stats/score_sheet_lineup_edit.html" %}
    {% endwith %}
</div>
<div id="away_substitutions" class="collapse showhide">
    {% with away_substitutions_formset as substitutions_formset %}
    {% include "stats/score_sheet_substitutions.html" %}
    {% endwith %}
</div>
{% endwith %}
{% with "home" as away_home %}
<div id="home_lineup" class="collapse showhide">
    {% with home_lineup_formset as lineup_formset %}
    {% include "stats/score_sheet_lineup_edit.html" %}
    {% endwith %}
</div>
<div id="home_substitutions" class="collapse showhide">
    {% with home_substitutions_formset as substitutions_formset %}
    {% include "stats/score_sheet_substitutions.html" %}
    {% endwith %}
</div>
{% endwith %}

{% if score_sheet.away_substitutions.all|length > 0 %}
<div>
    <h5>Away Substitutions</h5>
    <ol>
    {% for sub in score_sheet.away_substitutions.all %}
        <li>{{ sub }}</li>
    {% endfor %}
    </ol>
</div>
{% endif %}

{% if score_sheet.home_substitutions.all|length > 0 %}
<div>
    <h5>Home Substitutions</h5>
    <ol>
    {% for sub in score_sheet.home_substitutions.all %}
        <li>{{ sub }}</li>
    {% endfor %}
    </ol>
</div>
{% endif %}
<p></p>
{% if auto_save %}
    {% include 'stats/score_sheet/view.html' %}
{% else %}

<form name="score_sheet_games_form" action="{% url 'score_sheet_edit' score_sheet.id %}" method="post">
    {% csrf_token %}
    {{ games_formset.management_form }}
    <table class="table">
        {% include "stats/score_sheet_games_form.html" %}
        <tr>
            <td colspan="2"></td>
            <td id="home-wins-total" class="scoresheet-square"><b>{{ score_sheet.home_wins }}</b></td>
            <td></td>
            <td id="away-wins-total" class="scoresheet-square"><b>{{ score_sheet.away_wins }}</b></td>
            <td colspan="4"></td>
        </tr>
        <tr>
            <td></td>
            <td colspan="5">
                <div class="text-center">
                    <input id="games-save-button" name="games" class="btn btn-primary" type="submit" value="Save games"/>
                </div>
            </td>
            <td colspan="4"></td>
        </tr>
        <tr>
            <td></td>
            <td colspan="5">
                <div class="text-center">
                    <input id="last-game-reset-button" class="btn btn-default" type="button" value="reset last game" />
                </div>
            </td>
            <td colspan="4"></td>
        </tr>
    </table>
</form>
{% endif %}
    {%  with score_sheet.self_check as issues %}
        {% if issues|length %}
        <div>
            <ul>
            {%  for issue in issues %}
                <li>{{ issue }}</li>
            {% endfor %}
            </ul>
        </div>
        {% endif %}
    {%  endwith %}
{% if auto_save %}

{% else %}

    <div id="away-player-summaries"><h4>{{ score_sheet.match.away_team }} Player Summaries</h4>
    {% with player_score_sheet_summaries=away_player_score_sheet_summaries %}
    {% include "stats/player_match_summary.html" %}
    {% endwith %}
    </div>
    <div id="home-player-summaries"><h4>{{ score_sheet.match.home_team }} Player Summaries</h4>
    {% with player_score_sheet_summaries=home_player_score_sheet_summaries %}
    {% include "stats/player_match_summary.html" %}
    {% endwith %}
    </div>

{% endif %}

<form action="{% url 'score_sheet_edit' score_sheet.id %}" method="post">
    <table class="table">
    {{ score_sheet_completion_form.as_table }}
    </table>
    {% csrf_token %}
    <div class="text-center">
        <input name="complete" class="btn btn-primary" type="submit" value="Mark complete"/>
    </div>
</form>


<script>

function updateSummaryData(target) {
    $.ajax({
        url: summaryDataUrl,
        dataType: 'json',
        headers: {
            Accept: "application/json",
        },
        success: function(data) {
            target.teams = data;
            console.log('whee');
        },
    });
}
/*
let summariesApp = new Vue({
    el: '#summaries',
    data: {
        teams: {},
    },
    methods: {
        isOdd: function (number) {
            return number % 2;
        },
        updateData: function() {
            let self = this;
            updateSummaryData(self);
        },
    },
    mounted: function() {
        let self = this;
        updateSummaryData(self);
    }
});
*/
</script>
{% endblock %}
